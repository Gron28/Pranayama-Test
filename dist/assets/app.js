(()=>{var e={leftNostril:document.getElementById("left-nostril"),rightNostril:document.getElementById("right-nostril"),breathFill:document.getElementById("breath-fill"),breathBar:document.getElementById("breath-bar"),instruction:document.getElementById("instruction"),timer:document.getElementById("timer"),totalTime:document.getElementById("totalTime"),cyclesCompleted:document.getElementById("cyclesCompleted"),startBtn:document.getElementById("startBtn"),pauseBtn:document.getElementById("pauseBtn"),resetBtn:document.getElementById("resetBtn"),levelSelect:document.getElementById("level"),customModal:document.getElementById("customModal"),customIn:document.getElementById("customIn"),customOut:document.getElementById("customOut"),customHold:document.getElementById("customHold"),soundBtn:document.getElementById("soundBtn"),volumeSlider:document.getElementById("volumeSlider"),customizeBtn:document.getElementById("customizeBtn"),customizationPanel:document.getElementById("customizationPanel"),fullscreenBtn:document.getElementById("fullscreenBtn"),darkModeToggle:document.getElementById("darkModeToggle")};function y(l,n,s,o){let r=n==="left"?e.leftNostril:e.rightNostril,a=n==="left"?e.rightNostril:e.leftNostril;if(l==="ready"||l==="hold"?(a.style.opacity=1,r.style.opacity=1):(l==="out"||l==="in")&&(a.style.opacity=0,r.style.opacity=1),l==="ready")e.breathFill.style.height="100%",e.breathFill.classList.remove("hold"),r.style.transform="scale(1)",a.style.transform="scale(1)";else if(l==="out"){let c=1-.8*((o-s)/o);r.style.transform=`scale(${c})`,a.style.transform="scale(1)",e.breathFill.style.height=`${100-(o-s)/o*100}%`,e.breathFill.classList.remove("hold")}else if(l==="in"){let c=.2+.8*((o-s)/o);r.style.transform=`scale(${c})`,a.style.transform="scale(1)",e.breathFill.style.height=`${(o-s)/o*100}%`,e.breathFill.classList.remove("hold")}else l==="hold"&&(e.breathFill.classList.add("hold"),e.breathFill.style.height="100%",r.style.transform="scale(1)",a.style.transform="scale(1)");e.instruction.textContent=l==="ready"?"Select a level, breathe in and press Start to begin":l==="out"?`Breathe out through ${n} nostril`:l==="in"?`Breathe in through ${n} nostril`:"Hold breath",e.breathFill.setAttribute("aria-label",`Breath indicator - ${l}: ${s} seconds remaining`)}function C(l,n,s){let o=(s-n)/s*100;e.breathFill.setAttribute("aria-valuenow",o.toFixed(0)),e.breathFill.setAttribute("aria-valuemin",0),e.breathFill.setAttribute("aria-valuemax",100),e.breathBar.setAttribute("role","progressbar")}function P(){document.body.classList.toggle("fullscreen-mode");let l=document.body.classList.contains("fullscreen-mode");return e.fullscreenBtn.textContent=l?"Go Back":"Expand View",l}function B(l){document.body.classList.toggle("light-mode",!l),document.body.classList.toggle("dark-mode",l),e.darkModeToggle.textContent=l?"Light Mode":"Dark Mode",localStorage.setItem("darkMode",l)}function p(){let l=e.customizationPanel.style.display==="block";e.customizationPanel.style.display=l?"none":"block"}function x(){e.customModal.style.display="none",e.levelSelect.value==="custom"&&(e.levelSelect.value="1")}function H(){e.customModal.style.display="block"}var k=.02,f=!1,v=!1,d=new(window.AudioContext||window.webkitAudioContext);function F(l,n){let s=d.createOscillator(),o=d.createGain();s.type="sine",s.frequency.setValueAtTime(l,d.currentTime),s.connect(o),o.connect(d.destination),o.gain.setValueAtTime(k,d.currentTime);let r=d.currentTime+n;o.gain.linearRampToValueAtTime(0,r),s.start(),s.stop(r)}function T(){f&&!v&&(v=!0,F(185,.15),setTimeout(()=>{v=!1},150))}function g(l){if(f){let n=220;l==="in"||l==="out"?n=200:l==="hold"&&(n=280),setTimeout(()=>{F(n,.75)},v?150:0)}}function M(l){k=l}function w(){return f=!f,f}function A(){d.state==="suspended"&&d.resume()}var b={1:{out:20,in:10,hold:0},2:{out:30,in:15,hold:0},3:{out:15,in:15,hold:15},4:{out:40,in:20,hold:0},5:{out:20,in:10,hold:30}};function I(l,n=!1){let s=Math.floor(l/3600),o=Math.floor(l%3600/60),r=l%60,a=o.toString().padStart(2,"0"),c=r.toString().padStart(2,"0");return n?`${s.toString().padStart(2,"0")}:${a}:${c}`:`${a}:${c}`}var z=0,E=0,N=null,t={currentPhase:"ready",timeLeft:0,totalSeconds:0,cycles:0,currentNostril:"left",isPaused:!1,customConfig:{}};function $(){let l=performance.now(),n=Math.max(0,E-l);N=setTimeout(V,n)}function V(){if(!t.isPaused&&t.currentPhase!=="ready"){let n=performance.now()-E;if(n>150){let a=Math.floor(n/1e3);t.timeLeft-=a+1,t.totalSeconds+=a+1}else t.timeLeft--,t.totalSeconds++;E+=1e3,e.totalTime.textContent=I(t.totalSeconds,!0),e.timer.textContent=I(t.timeLeft);let s=e.levelSelect.value,r=(b[s]||t.customConfig)[t.currentPhase==="out"?"out":t.currentPhase==="in"?"in":"hold"];y(t.currentPhase,t.currentNostril,t.timeLeft,r),T(),t.timeLeft<=0&&D()}!t.isPaused&&t.currentPhase!=="ready"&&$()}function D(){let l=e.levelSelect.value,n=b[l]||t.customConfig;t.currentPhase==="out"?(t.currentPhase="in",t.timeLeft=n.in,g("in")):t.currentPhase==="in"?n.hold>0?(t.currentPhase="hold",t.timeLeft=n.hold,g("hold")):(t.currentPhase="out",t.currentNostril=t.currentNostril==="left"?"right":"left",t.timeLeft=n.out,g("out"),t.currentNostril==="left"&&(t.cycles++,e.cyclesCompleted.textContent=t.cycles)):t.currentPhase==="hold"&&(t.currentPhase="out",t.currentNostril=t.currentNostril==="left"?"right":"left",t.timeLeft=n.out,g("out"),t.currentNostril==="left"&&(t.cycles++,e.cyclesCompleted.textContent=t.cycles)),y(t.currentPhase,t.currentNostril,t.timeLeft,n[t.currentPhase]),C(t.currentPhase,t.timeLeft,n[t.currentPhase])}function O(){if(t.currentPhase==="ready"||t.isPaused){let l=e.levelSelect.value,n=b[l];l==="custom"&&(n=t.customConfig),t.currentPhase==="ready"&&(t.currentPhase="out",t.timeLeft=n.out,t.currentNostril="left"),t.isPaused=!1,z=performance.now(),E=z+1e3,$(),e.startBtn.disabled=!0,e.pauseBtn.disabled=!1,e.resetBtn.disabled=!1,e.leftNostril.classList.remove("paused"),e.rightNostril.classList.remove("paused"),e.breathFill.classList.remove("paused")}}function q(){clearTimeout(N),t.isPaused=!0,e.startBtn.disabled=!1,e.startBtn.textContent="Resume",e.leftNostril.classList.add("paused"),e.rightNostril.classList.add("paused"),e.breathFill.classList.add("paused")}function S(){clearTimeout(N),t.currentPhase="ready",t.timeLeft=0,t.totalSeconds=0,t.cycles=0,t.currentNostril="left",t.isPaused=!1,e.startBtn.disabled=!1,e.startBtn.textContent="Start",e.pauseBtn.disabled=!0,e.resetBtn.disabled=!0,e.timer.textContent="00:00",e.totalTime.textContent="00:00:00",e.cyclesCompleted.textContent="0",y("ready",t.currentNostril,0,0),C("ready",0,0)}function G(){function l(){let o=document.getElementById("leftNostrilColor").value,r=document.getElementById("rightNostrilColor").value,a=document.getElementById("breathBarFillColor").value,c=document.getElementById("breathBarHoldColor").value;document.documentElement.style.setProperty("--ida-blue",o),document.documentElement.style.setProperty("--pingala-red",r),document.documentElement.style.setProperty("--sushumna-yellow",a),document.documentElement.style.setProperty("--sushumna-green",c),localStorage.setItem("customColors",JSON.stringify({leftNostril:o,rightNostril:r,breathFill:a,breathHold:c})),document.getElementById("leftNostrilHex").value=o,document.getElementById("rightNostrilHex").value=r,document.getElementById("breathBarFillHex").value=a,document.getElementById("breathBarHoldHex").value=c}function n(){let o={leftNostril:"#004dab",rightNostril:"#ff2a00",breathFill:"#fee74d",breathHold:"#00a550"};document.getElementById("leftNostrilColor").value=o.leftNostril,document.getElementById("rightNostrilColor").value=o.rightNostril,document.getElementById("breathBarFillColor").value=o.breathFill,document.getElementById("breathBarHoldColor").value=o.breathHold,document.getElementById("leftNostrilHex").value=o.leftNostril,document.getElementById("rightNostrilHex").value=o.rightNostril,document.getElementById("breathBarFillHex").value=o.breathFill,document.getElementById("breathBarHoldHex").value=o.breathHold,l()}["leftNostrilColor","rightNostrilColor","breathBarFillColor","breathBarHoldColor"].forEach(o=>{document.getElementById(o).addEventListener("input",()=>{let r=o.replace("Color","Hex");document.getElementById(r).value=document.getElementById(o).value,l()})}),["leftNostrilHex","rightNostrilHex","breathBarFillHex","breathBarHoldHex"].forEach(o=>{document.getElementById(o).addEventListener("input",()=>{let r=o.replace("Hex","Color");document.getElementById(r).value=document.getElementById(o).value,l()})}),document.getElementById("saveChanges").addEventListener("click",()=>{l(),p()}),document.getElementById("resetChanges").addEventListener("click",()=>{localStorage.removeItem("customColors"),localStorage.removeItem("darkMode"),n(),l(),B(!0)});function s(){let o=JSON.parse(localStorage.getItem("customColors")),r=JSON.parse(localStorage.getItem("darkMode"));o&&(document.getElementById("leftNostrilColor").value=o.leftNostril,document.getElementById("rightNostrilColor").value=o.rightNostril,document.getElementById("breathBarFillColor").value=o.breathFill,document.getElementById("breathBarHoldColor").value=o.breathHold,document.documentElement.style.setProperty("--ida-blue",o.leftNostril),document.documentElement.style.setProperty("--pingala-red",o.rightNostril),document.documentElement.style.setProperty("--sushumna-yellow",o.breathFill),document.documentElement.style.setProperty("--sushumna-green",o.breathHold),document.getElementById("leftNostrilHex").value=o.leftNostril,document.getElementById("rightNostrilHex").value=o.rightNostril,document.getElementById("breathBarFillHex").value=o.breathFill,document.getElementById("breathBarHoldHex").value=o.breathHold),B(r!==!1)}s()}function J(){e.startBtn.addEventListener("click",()=>{O(),A()}),e.pauseBtn.addEventListener("click",q),e.resetBtn.addEventListener("click",S),e.levelSelect.addEventListener("change",()=>{e.levelSelect.value==="custom"?(t.customConfig.in=t.customConfig.in||"",t.customConfig.out=t.customConfig.out||"",t.customConfig.hold=t.customConfig.hold||0,e.customIn.value=t.customConfig.in,e.customOut.value=t.customConfig.out,e.customHold.value=t.customConfig.hold,H()):S()}),e.soundBtn.addEventListener("click",()=>{let i=w(),m=e.soundBtn.querySelector("i");m.className=i?"fas fa-volume-up":"fas fa-volume-mute"}),e.volumeSlider.addEventListener("input",()=>{M(parseFloat(e.volumeSlider.value))}),e.customizeBtn.addEventListener("click",p),e.darkModeToggle.addEventListener("click",()=>{let i=document.body.classList.contains("dark-mode");B(!i)}),e.fullscreenBtn.addEventListener("click",P);let l=document.querySelector("#customModal .close-button"),n=document.querySelector("#customModal .cancel"),s=document.querySelector("#customModal .save"),o=document.querySelector(".modal-content");function r(){x()}function a(){let i=parseInt(e.customIn.value,10),m=parseInt(e.customOut.value,10),h=parseInt(e.customHold.value,10),L=o.querySelector(".error-message");if(L&&o.removeChild(L),i>0&&m>0){t.customConfig={in:i,out:m,hold:h};let u=e.levelSelect.options[e.levelSelect.selectedIndex];u.textContent=`Custom (In: ${i}s, Out: ${m}s, Hold: ${h}s)`,x()}else{let u=document.createElement("p");u.textContent="Inhale and Exhale times must be greater than 0.",u.style.color="red",u.classList.add("error-message"),o.insertBefore(u,s),e.customIn.addEventListener("input",()=>{o.contains(u)&&u.remove()}),e.customOut.addEventListener("input",()=>{o.contains(u)&&u.remove()})}}l.addEventListener("click",r),n.addEventListener("click",r),s.addEventListener("click",a),window.addEventListener("click",i=>{i.target===e.customModal&&r()}),document.querySelectorAll(".collapsible-header").forEach(i=>{i.addEventListener("click",()=>{let m=i.nextElementSibling,h=i.querySelector(".toggle-icon");m.classList.toggle("collapsed"),h.classList.toggle("open")})}),document.addEventListener("click",i=>{e.customizationPanel.style.display==="block"&&!i.target.closest("#customizationPanel")&&i.target!==e.customizeBtn&&p()})}function ee(){e.volumeSlider.value=.02,G(),J()}})();
