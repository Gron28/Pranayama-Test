<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pranayama Practice Guide</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
:root {
    --background-color: #101010;
    --text-color: #f8f0e3;
    --ida-blue: #004dab;
    --pingala-red: #ff2a00;
    --sushumna-yellow: #fee74d;
    --sushumna-green: #00a550;
    --neutral-color: #101010;
    --font-family-base: 'Space Mono', monospace;
}
body {
    background-color: var(--background-color);
    color: var(--text-color);
    font-family: var(--font-family-base);
    margin: 0;
    padding: 20px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    line-height: 1;
}
h1, h2, h3, p, button, select, .timer, .instruction, .stats {
    font-family: var(--font-family-base);
}
.container {
    text-align: center;
    width: 90%;
    max-width: 800px;
    margin-bottom: 5px;
}
        h1 {
            margin-bottom: 20px;
        }
        .level-select {
            margin-bottom: 20px;
        }
        select {
            padding: 8px;
            font-size: 16px;
            background-color: #333;
            color: var(--text-color);
            border: 1px solid #666;
            border-radius: 5px;
        }
        .practice-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            margin: 40px 0;
            height: 270px;
        }
        .nostril-circle {
    aspect-ratio: 1 / 1;
    width: 165px;
    max-width: 30vw;
    border-radius: 50%;
    transition: transform 1s linear, opacity 1s linear;
}
@media (max-width: 768px) {
    .nostril-circle {
        width: 165px;
    }
}
@media (max-width: 480px) {
    .nostril-circle {
        width: 130px;
    }
    select {
            width: 350px
        }
}
        .left-nostril {
            background-color: var(--ida-blue);
        }
        .right-nostril {
            background-color: var(--pingala-red);
        }
        .breath-bar {
            width: 35px;
            height: 250px;
            background-color: var(--neutral-color);
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }
        .breath-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--sushumna-yellow);
            height: 100%;
            transition: height 1s linear, background-color 0.3s ease;
        }
        .breath-fill.hold {
            background-color: var(--sushumna-green);
        }
        .instruction {
            font-size: 17px;
            margin-bottom: 20px;
        }
        .timer {
            font-size: 61px;
            margin-bottom: 20px;
        }
        .controls {
    display: flex;
    justify-content: center;
    gap: 10px;
}
.control-button {
    padding: 10px 20px;
    font-size: 14px;
    background-color: rgb(110, 110, 110);
    color: var(--text-color);
    border: none;
    border-radius: 5px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 5px;
}
.control-button:disabled {
    background-color: rgb(48, 48, 48);
    cursor: not-allowed;
}
.stats {
    margin-top: 20px;
    font-size: 14px;
}
.stats p {
    margin-bottom: 5px;
}
.sound-controls {
    margin-top: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}
.sound-controls button {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1.5em;
    color: var(--text-color);
    padding: 0;
}
#volumeSlider {
    width: 100px;
    height: 8px;
    background: #666;
    border-radius: 5px;
    outline: none;
}
#volumeSlider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 15px;
    height: 15px;
    background: var(--sushumna-yellow);
    border-radius: 50%;
    cursor: pointer;
}
#volumeSlider::-moz-range-thumb {
    width: 15px;
    height: 15px;
    background: var(--sushumna-yellow);
    border-radius: 50%;
    cursor: pointer;
    border: none;
}
.recommendations {
    text-align: left;
    max-width: 800px;
    margin-bottom: 20px;
}
.recommendations p {
    line-height: 1.5;
    margin-bottom: 10px;
    font-size: 0.9rem;
    color: var(--text-color);
}
.liber-ix-excerpts {
    margin-top: 40px;
    font-size: 0.9rem;
    text-align: left;
    max-width: 800px;
    color: var(--text-color);
    line-height: 1.6;
    margin-bottom: 65px;
}
.liber-ix-excerpts h2 {
    font-size: 1.1em;
    margin-bottom: 10px;
    text-align: center;
    color: var(--text-color);
}
.liber-ix-excerpts h3 {
    text-align: center;
}
#liber-ix-title {
    color: var(--text-color);
    text-decoration: underline;
}
    </style>
</head>
<body>
    <div class="container">
        <h1>Pranayama Practice</h1>
        <div class="level-select">
            <select id="level">
                <option value="1">Level 1 (Out: 20s, In: 10s)</option>
                <option value="2">Level 2 (Out: 30s, In: 15s)</option>
                <option value="3">Level 3 (Out: 15s, In: 15s, Hold: 15s)</option>
                <option value="4">Level 4 (Out: 40s, In: 20s)</option>
                <option value="5">Level 5 (Out: 20s, In: 10s, Hold: 30s)</option>
            </select>
        </div>
        <section class="practice-area" aria-live="polite">
            <div id="left-nostril" class="nostril-circle left-nostril" aria-label="Left nostril"></div>
            <div class="breath-bar" aria-label="Breath indicator">
                <div id="breath-fill" class="breath-fill"></div>
            </div>
            <div id="right-nostril" class="nostril-circle right-nostril" aria-label="Right nostril"></div>
        </section>
        <div id="timer" class="timer">00:00</div>
        <div id="instruction" class="instruction">Select a level and press Start to begin</div>
        <section class="controls">
            <button id="startBtn" class="control-button" aria-label="Start practice">
                Start
            </button>
            <button id="pauseBtn" class="control-button" aria-label="Pause practice" disabled>
                Pause
            </button>
            <button id="resetBtn" class="control-button" aria-label="Reset practice" disabled>
                Reset
            </button>
        </section>
        <div class="stats">
            <p>Total Practice Time: <span id="totalTime">00:00:00</span> / Cycles Completed: <span id="cyclesCompleted">0</span></p>
        </div>
    </div>
    <section class="sound-controls">
        <p>Sound Cues</p>
        <button id="soundBtn" aria-label="Toggle sound cues">
            <i class="fas fa-volume-mute"></i>
        </button>
        <input type="range" id="volumeSlider" min="0" max="0.3" step="0.01" value="0.02" aria-label="Adjust sound volume">
    </section>
    </div>
    <section class="recommendations">
        <h3>Recommendations:</h3>
        <p>Please approach this practice with ease. Think of it as guiding your breath, not forcing it. And remember to take notes.</p>
    </section>
    <section class="liber-ix-excerpts">
        <h2>Excerpt from <a href="https://keepsilence.org/the-equinox/1.1/liber-exercitiorum_low.pdf" target="_blank" id="liber-ix-title">LIBER E. VEL EXERCITIORVM SVB FIGVRA IX</a>:</h2>
        <h3>Pranayamaâ€”Regularisation of the Breathing</h3>
        <ol>
            <li>At rest. in one of your positions, close the right nostril with the thumb of the right hand and breathe out slowly and completely through the left nostril, while your watch marks 20 seconds. Breathe in through the same nostril for 10 seconds. Changing hands, repeat with the other nostril. Let this be continuous for one hour.</li>
            <li>When this is quite easy to you, increase the periods to 30 and 15 seconds.</li>
            <li>When this is quite easy to you, but not before, breathe out for 15 seconds, in for 15 seconds, and hold the breath for 15 seconds.</li>
            <li>When you can do this with perfect ease and comfort for a whole hour, practise breathing out for 40, in for 20 seconds.</li>
            <li>This being attained, practise breathing out for 20, in for 10, holding the breath for 30 seconds. When this has become perfectly easy to you, you may be admitted for examination, and should you pass, you will be instructed in more complex and difficult practices.</li>
            <li>You will find that the presence of food in the stomach, even in small quantities, makes the practices very difficult.</li>
            <li>Be very careful never to overstrain your powers; especially never get so short of breath that you are compelled to breathe out jerkily or rapidly.</li>
            <li>Strive after depth, fulness, and regularity of breathing.</li>
            <li>Various remarkable phenomena will very probably occur during these practices. They must be carefully analysed and recorded.</li>
        </ol>
    </section>
</div>
    <script>
        const levelConfigs = {
            1: { out: 20, in: 10, hold: 0 },
            2: { out: 30, in: 15, hold: 0 },
            3: { out: 15, in: 15, hold: 15 },
            4: { out: 40, in: 20, hold: 0 },
            5: { out: 20, in: 10, hold: 30 }
        };
        let timer;
        let currentPhase = 'ready';
        let timeLeft = 0;
        let totalSeconds = 0;
        let cycles = 0;
        let currentNostril = 'left';
        let isPaused = false;
        let globalVolume = 0.02;
        const elements = {
            leftNostril: document.getElementById('left-nostril'),
            rightNostril: document.getElementById('right-nostril'),
            breathFill: document.getElementById('breath-fill'),
            instruction: document.getElementById('instruction'),
            timer: document.getElementById('timer'),
            totalTime: document.getElementById('totalTime'),
            cyclesCompleted: document.getElementById('cyclesCompleted'),
            startBtn: document.getElementById('startBtn'),
            pauseBtn: document.getElementById('pauseBtn'),
            resetBtn: document.getElementById('resetBtn'),
            levelSelect: document.getElementById('level')
        };
        function pauseAnimation(element) {
            element.classList.add("paused");
        }
        function resumeAnimation(element) {
            element.classList.remove("paused");
        }
        function updateBreathVisualization(phase, nostril, timeLeft, duration) {
            const activeNostril = (nostril === 'left') ? elements.leftNostril : elements.rightNostril;
            const inactiveNostril = (nostril === 'left') ? elements.rightNostril : elements.leftNostril;
            if (phase === 'ready' || phase === 'hold') {
                inactiveNostril.style.opacity = 1;
                activeNostril.style.opacity = 1;
            } else if (phase === 'out' || phase === 'in'){
                inactiveNostril.style.opacity = 0;
                activeNostril.style.opacity = 1;
            }
            if (phase === 'ready') {
                elements.breathFill.style.height = '100%';
                elements.breathFill.classList.remove('hold');
                activeNostril.style.transform = 'scale(1)';
                inactiveNostril.style.transform = 'scale(1)';
            } else if (phase === 'out') {
                const scale = 1 - (1 - 0.2) * ((duration - timeLeft) / duration);
                activeNostril.style.transform = `scale(${scale})`;
                inactiveNostril.style.transform = 'scale(1)';
                elements.breathFill.style.height = `${100 - ((duration - timeLeft) / duration) * 100}%`;
                elements.breathFill.classList.remove('hold');
            } else if (phase === 'in') {
                const scale = 0.2 + (1 - 0.2) * ((duration - timeLeft) / duration);
                activeNostril.style.transform = `scale(${scale})`;
                inactiveNostril.style.transform = 'scale(1)';
                elements.breathFill.style.height = `${((duration - timeLeft) / duration) * 100}%`;
                elements.breathFill.classList.remove('hold');
            } else if (phase === 'hold') {
                elements.breathFill.classList.add('hold');
                elements.breathFill.style.height = '100%';
                activeNostril.style.transform = 'scale(1)';
                inactiveNostril.style.transform = 'scale(1)';
            }
            elements.instruction.textContent =
                phase === 'ready' ? 'Select a level and press Start to begin' :
                phase === 'out' ? `Breathe out through ${nostril} nostril` :
                phase === 'in' ? `Breathe in through ${nostril} nostril` :
                'Hold breath';
        }
        function updateTimer() {
    if (!isPaused && currentPhase !== 'ready') {
        timeLeft--;
        totalSeconds++;
        elements.totalTime.textContent = formatTime(totalSeconds, true);
        elements.timer.textContent = formatTime(timeLeft);
        const config = levelConfigs[elements.levelSelect.value];
        const duration = config[currentPhase === 'out' ? 'out' : currentPhase === 'in' ? 'in' : 'hold'];
        updateBreathVisualization(currentPhase, currentNostril, timeLeft, duration);
        playTickSound();
        if (timeLeft <= 0) {
            nextPhase();
        }
    }
}
function nextPhase() {
    const config = levelConfigs[elements.levelSelect.value];

    if (currentPhase === 'out') {
        currentPhase = 'in';
        timeLeft = config.in;
        playPhaseTransitionSound('in');
    } else if (currentPhase === 'in') {
        if (config.hold > 0) {
            currentPhase = 'hold';
            timeLeft = config.hold;
            playPhaseTransitionSound('hold');
        } else {
            currentPhase = 'out';
            currentNostril = currentNostril === 'left' ? 'right' : 'left';
            timeLeft = config.out;
            playPhaseTransitionSound('out');
            if (currentNostril === 'left') { 
                cycles++;
                elements.cyclesCompleted.textContent = cycles;
            }
        }
    } else if (currentPhase === 'hold') {
        currentPhase = 'out';
        currentNostril = currentNostril === 'left' ? 'right' : 'left';
        timeLeft = config.out;
        playPhaseTransitionSound('out');
        if (currentNostril === 'left') { 
            cycles++;
            elements.cyclesCompleted.textContent = cycles;
        }
    }

    updateBreathVisualization(currentPhase, currentNostril, timeLeft, config[currentPhase]);
}
        function formatTime(seconds, includeHours = false) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            if (includeHours) {
                return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            }
            return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }
        elements.startBtn.addEventListener('click', () => {
            if (currentPhase === 'ready' || isPaused) {
                const config = levelConfigs[elements.levelSelect.value];
                if (currentPhase === 'ready') {
                    currentPhase = 'out';
                    timeLeft = config.out;
                    currentNostril = 'left';
                }
                isPaused = false;
                timer = setInterval(updateTimer, 1000);
                elements.startBtn.disabled = true;
                elements.pauseBtn.disabled = false;
                elements.resetBtn.disabled = false;
                elements.levelSelect.disabled = true;
                elements.startBtn.textContent = 'Start';
                resumeAnimation(elements.leftNostril);
                resumeAnimation(elements.rightNostril);
                resumeAnimation(elements.breathFill);
            }
        });
        elements.pauseBtn.addEventListener('click', () => {
            clearInterval(timer);
            isPaused = true;
            elements.startBtn.disabled = false;
            elements.startBtn.textContent = 'Resume';
            pauseAnimation(elements.leftNostril);
            pauseAnimation(elements.rightNostril);
            pauseAnimation(elements.breathFill);
        });
        elements.resetBtn.addEventListener('click', () => {
            clearInterval(timer);
            currentPhase = 'ready';
            timeLeft = 0;
            totalSeconds = 0;
            cycles = 0;
            currentNostril = 'left';
            isPaused = false;
            elements.startBtn.disabled = false;
            elements.startBtn.textContent = 'Start';
            elements.pauseBtn.disabled = true;
            elements.resetBtn.disabled = true;
            elements.levelSelect.disabled = false;
            elements.timer.textContent = '00:00';
            elements.totalTime.textContent = '00:00:00';
            elements.cyclesCompleted.textContent = '0';
            updateBreathVisualization('ready', currentNostril, 0, 0);
        });
        elements.levelSelect.addEventListener('change', () => {
            elements.resetBtn.click();
        });
        const soundBtn = document.getElementById('soundBtn');
        const volumeSlider = document.getElementById('volumeSlider');
        let soundEnabled = false;
        soundBtn.addEventListener('click', () => {
    soundEnabled = !soundEnabled;
    const icon = soundBtn.querySelector('i');
    icon.className = soundEnabled ? 'fas fa-volume-up' : 'fas fa-volume-mute';
});
        volumeSlider.addEventListener('input', () => {
    globalVolume = parseFloat(volumeSlider.value);
});
function playTickSound(frequency = 220) {
    if (!soundEnabled) return;
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    oscillator.type = 'sine';
    oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    gainNode.gain.setValueAtTime(globalVolume, audioContext.currentTime);
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.1);
}
function playPhaseTransitionSound(phase) {
    if (!soundEnabled) return;
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    oscillator.type = 'sine';
    oscillator.frequency.setValueAtTime(
        phase === 'in' ? 340 : phase === 'out' ? 300 : 450,
        audioContext.currentTime
    );
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    gainNode.gain.setValueAtTime(globalVolume, audioContext.currentTime);
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.5);
}
window.onload = () => {
    volumeSlider.value = globalVolume;
};
    </script>
</body>
</html>